<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f172a">
<title>Flow45 â€” 9-Week Muscle Confusion</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUDQ1eCIsInNob3J0X25hbWUiOiJQNDV4Iiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwZjE3MmEiLCJ0aGVtZV9jb2xvciI6IiMwZjE3MmEifQ==">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        navy: { 800: '#1e293b', 900: '#0f172a', 950: '#020617' },
        fire: { 400: '#fb923c', 500: '#f97316', 600: '#ea580c' }
      }
    }
  }
}
</script>
<link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-navy-950 text-gray-100 min-h-screen pb-24 select-none">

<!-- Profile Setup Overlay -->
<div id="profile-overlay" class="fixed inset-0 z-[100] bg-navy-950 flex items-center justify-center hide">
  <div class="max-w-sm w-full mx-4 text-center">
    <div class="text-5xl mb-4">ğŸ‹ï¸</div>
    <h1 class="text-3xl font-extrabold text-fire-500 mb-2">Flow45</h1>
    <p class="text-slate-400 mb-8">Set up your profile to personalize your workouts.</p>

    <div class="mb-6">
      <label class="block text-sm font-bold text-slate-300 mb-3">I am aâ€¦</label>
      <div class="flex gap-3 justify-center">
        <button onclick="selectProfileGender('man')" id="pg-man" class="profile-gender-btn bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-xl font-bold text-lg active:scale-95 transition">ğŸ™‹â€â™‚ï¸ Man</button>
        <button onclick="selectProfileGender('woman')" id="pg-woman" class="profile-gender-btn bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-xl font-bold text-lg active:scale-95 transition">ğŸ™‹â€â™€ï¸ Woman</button>
      </div>
    </div>

    <div class="mb-8">
      <label class="block text-sm font-bold text-slate-300 mb-3">Age Group</label>
      <div class="flex gap-3 justify-center">
        <button onclick="selectProfileAge('young')" id="pa-young" class="profile-age-btn bg-slate-700 hover:bg-slate-600 px-4 py-3 rounded-xl font-bold active:scale-95 transition">âš¡ Young<br><span class="text-xs font-normal text-slate-400">18-30</span></button>
        <button onclick="selectProfileAge('adult')" id="pa-adult" class="profile-age-btn bg-slate-700 hover:bg-slate-600 px-4 py-3 rounded-xl font-bold active:scale-95 transition">ğŸ¯ Adult<br><span class="text-xs font-normal text-slate-400">30-55</span></button>
        <button onclick="selectProfileAge('senior')" id="pa-senior" class="profile-age-btn bg-slate-700 hover:bg-slate-600 px-4 py-3 rounded-xl font-bold active:scale-95 transition">ğŸŒ¿ Senior<br><span class="text-xs font-normal text-slate-400">55+ â€¢ Gentle</span></button>
      </div>
    </div>

    <button onclick="confirmProfile()" id="profile-confirm-btn" class="w-full bg-fire-500 hover:bg-fire-600 text-white font-bold py-4 rounded-2xl text-lg active:scale-95 transition opacity-30 pointer-events-none" disabled>
      Let's Go ğŸ”¥
    </button>
  </div>
</div>

<div id="app">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-navy-950/95 backdrop-blur px-4 pt-3 pb-2 border-b border-slate-800">
    <div class="flex items-center justify-between">
      <h1 class="text-xl font-extrabold text-fire-500">ğŸ‹ï¸ Flow45</h1>
      <div class="flex items-center gap-3">
        <div id="header-timer" class="text-sm text-slate-400 hide">
          <span id="header-timer-display">00:00</span>
        </div>
        <span id="header-profile-badge" class="text-xs text-slate-500 bg-slate-800 px-2 py-1 rounded-lg cursor-pointer" onclick="openProfileSettings()" title="Change profile"></span>
        <div class="text-xs text-slate-500" id="header-date"></div>
      </div>
    </div>
    <!-- Phase Banner -->
    <div id="phase-banner" class="mt-2 rounded-xl p-2 text-center font-bold text-sm"></div>
  </header>

  <!-- Pages -->
  <main class="px-4 py-4 max-w-lg mx-auto">
    <!-- TODAY PAGE -->
    <div id="page-today" class="page">
      <div id="today-rest-day" class="hide text-center py-16">
        <div class="text-6xl mb-4">ğŸ˜´</div>
        <h2 class="text-2xl font-bold mb-2">Rest Day</h2>
        <p class="text-slate-400">Light walking or full rest. You earned it!</p>
        <p class="text-slate-500 mt-4 text-sm">ğŸ’§ Still drink your water!</p>
      </div>
      <div id="today-content">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-lg font-bold" id="today-title"></h2>
            <p class="text-sm text-slate-400" id="today-subtitle"></p>
          </div>
          <div class="text-right">
            <div class="text-xs text-slate-500" id="today-est-time"></div>
            <div class="text-xs text-fire-400" id="today-progress-text"></div>
          </div>
        </div>

        <!-- PKD Notice -->
        <div id="pkd-notice" class="bg-blue-900/30 border border-blue-800/50 rounded-xl p-3 mb-4 text-sm">
          <p class="text-blue-300">âš ï¸ <strong>PKD Reminder:</strong> Moderate weight, perfect form. Avoid heavy straining & valsalva. Breathe through every rep. Burpees: step back, no jump, no push-up.</p>
        </div>

        <!-- Workout Timer Launch Button -->
        <button onclick="openTimerPopup()" class="w-full bg-navy-800 hover:bg-navy-900 rounded-2xl p-4 mb-4 flex items-center justify-between active:scale-[0.98] transition">
          <div class="flex items-center gap-3">
            <span class="text-2xl">â±</span>
            <div class="text-left">
              <div class="font-bold text-fire-400">Workout Timer</div>
              <div class="text-xs text-slate-400">Tap to open timer & rest controls</div>
            </div>
          </div>
          <span class="text-slate-500 text-lg">â–¶ï¸</span>
        </button>

        <!-- Hydration Reminder -->
        <div id="hydration-reminder" class="hide bg-cyan-900/30 border border-cyan-700/40 rounded-xl p-3 mb-4 text-center">
          <span class="text-2xl water-drop inline-block">ğŸ’§</span>
          <span class="text-cyan-300 font-semibold ml-2">Time for water! Stay hydrated.</span>
          <button onclick="dismissHydration()" class="ml-2 text-cyan-500 underline text-sm">Got it</button>
        </div>

        <!-- Exercise Sections -->
        <div id="today-sections"></div>

        <!-- Complete Workout -->
        <button id="complete-workout-btn" onclick="completeWorkout()" class="hide w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-2xl text-lg mt-4 active:scale-95 transition">
          âœ… Complete Workout
        </button>
      </div>
    </div>

    <!-- EXERCISES PAGE -->
    <div id="page-exercises" class="page hide">
      <div class="mb-4">
        <input type="search" id="exercise-search" placeholder="Search exercises..." oninput="filterExercises()" class="w-full bg-navy-800 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-fire-500">
      </div>
      <div class="flex gap-2 mb-4 overflow-x-auto pb-1" id="category-filters">
        <button onclick="filterCategory('all')" class="cat-btn bg-fire-500 text-white px-3 py-1.5 rounded-lg text-sm whitespace-nowrap font-semibold" data-cat="all">All</button>
        <button onclick="filterCategory('flow')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="flow">ğŸ» Animal Flow</button>
        <button onclick="filterCategory('push')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="push">ğŸ’ª Push</button>
        <button onclick="filterCategory('pull')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="pull">ğŸ”™ Pull</button>
        <button onclick="filterCategory('legs')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="legs">ğŸ¦µ Legs</button>
        <button onclick="filterCategory('bodyweight')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="bodyweight">ğŸƒ Bodyweight</button>
        <button onclick="filterCategory('compound')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="compound">ğŸ”¥ Compound</button>
        <button onclick="filterCategory('stretch')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="stretch">ğŸ§˜ Stretch</button>
        <button onclick="filterCategory('yoga')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="yoga">ğŸ§˜â€â™€ï¸ Yoga</button>
        <button onclick="filterCategory('kb')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="kb">ğŸ”” Kettlebell</button>
        <button onclick="filterCategory('glute')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="glute">ğŸ‘ Glute/Hip</button>
        <button onclick="filterCategory('abs')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="abs">ğŸ¯ Abs</button>
        <button onclick="filterCategory('senior')" class="cat-btn bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-sm whitespace-nowrap" data-cat="senior">ğŸŒ¿ Senior</button>
      </div>
      <div id="exercise-list"></div>
    </div>

    <!-- WEEK PAGE -->
    <div id="page-week" class="page hide">
      <h2 class="text-lg font-bold mb-4">ğŸ“… This Week</h2>
      <div id="week-grid" class="space-y-3"></div>
    </div>

    <!-- PROGRESS PAGE -->
    <div id="page-progress" class="page hide">
      <h2 class="text-lg font-bold mb-4">ğŸ“Š Progress</h2>

      <!-- Stats -->
      <div class="grid grid-cols-3 gap-3 mb-6">
        <div class="bg-navy-800 rounded-xl p-3 text-center">
          <div class="text-2xl font-bold text-fire-500" id="stat-streak">0</div>
          <div class="text-xs text-slate-400">Day Streak</div>
        </div>
        <div class="bg-navy-800 rounded-xl p-3 text-center">
          <div class="text-2xl font-bold text-fire-500" id="stat-week">0%</div>
          <div class="text-xs text-slate-400">This Week</div>
        </div>
        <div class="bg-navy-800 rounded-xl p-3 text-center">
          <div class="text-2xl font-bold text-fire-500" id="stat-total">0</div>
          <div class="text-xs text-slate-400">Total</div>
        </div>
      </div>

      <!-- Water Tracker -->
      <div class="bg-navy-800 rounded-xl p-4 mb-6">
        <h3 class="font-bold mb-3">ğŸ’§ Water Intake Today</h3>
        <div class="flex items-center gap-3">
          <div class="flex gap-1" id="water-glasses"></div>
          <span class="text-sm text-slate-400" id="water-count">0/8</span>
        </div>
        <div class="flex gap-2 mt-3">
          <button onclick="addWater()" class="bg-cyan-700 hover:bg-cyan-600 px-4 py-2 rounded-lg text-sm font-semibold active:scale-95 transition">+ Glass</button>
          <button onclick="resetWater()" class="bg-slate-700 px-3 py-2 rounded-lg text-sm active:scale-95 transition">Reset</button>
        </div>
      </div>

      <!-- Calendar Heatmap -->
      <div class="bg-navy-800 rounded-xl p-4 mb-6">
        <h3 class="font-bold mb-3">Workout Calendar</h3>
        <div id="heatmap" class="flex flex-wrap gap-1"></div>
        <div class="flex gap-3 mt-2 text-xs text-slate-500">
          <span class="flex items-center gap-1"><span class="heatmap-cell bg-slate-700 inline-block"></span> No workout</span>
          <span class="flex items-center gap-1"><span class="heatmap-cell bg-fire-500 inline-block"></span> Completed</span>
        </div>
      </div>

      <!-- Weight Log -->
      <div class="bg-navy-800 rounded-xl p-4 mb-6">
        <h3 class="font-bold mb-3">ğŸ‹ï¸ Weight Log</h3>
        <div class="flex gap-2 mb-3">
          <select id="weight-exercise" class="bg-slate-700 rounded-lg px-3 py-2 text-sm flex-1"></select>
          <input type="number" id="weight-value" placeholder="lbs" class="bg-slate-700 rounded-lg px-3 py-2 text-sm w-20">
          <button onclick="logWeight()" class="bg-fire-500 px-3 py-2 rounded-lg text-sm font-semibold active:scale-95">Log</button>
        </div>
        <div id="weight-history" class="text-sm text-slate-400 max-h-40 overflow-y-auto space-y-1"></div>
      </div>

      <!-- Data Management -->
      <div class="bg-navy-800 rounded-xl p-4">
        <h3 class="font-bold mb-3">âš™ï¸ Data</h3>
        <div class="flex gap-2">
          <button onclick="exportData()" class="bg-slate-700 px-4 py-2 rounded-lg text-sm">Export</button>
          <button onclick="if(confirm('Reset all data?'))resetAllData()" class="bg-red-900/50 text-red-400 px-4 py-2 rounded-lg text-sm">Reset All</button>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Bottom Nav -->
<nav class="fixed bottom-0 left-0 right-0 bg-navy-900/95 backdrop-blur border-t border-slate-800 z-50">
  <div class="flex justify-around max-w-lg mx-auto">
    <button onclick="showPage('today')" class="nav-btn flex flex-col items-center py-3 px-4 tab-active" data-page="today">
      <span class="text-xl">ğŸ’ª</span><span class="text-[10px] mt-0.5">Today</span>
    </button>
    <button onclick="showPage('exercises')" class="nav-btn flex flex-col items-center py-3 px-4 text-slate-500" data-page="exercises">
      <span class="text-xl">ğŸ“š</span><span class="text-[10px] mt-0.5">Exercises</span>
    </button>
    <button onclick="showPage('week')" class="nav-btn flex flex-col items-center py-3 px-4 text-slate-500" data-page="week">
      <span class="text-xl">ğŸ“…</span><span class="text-[10px] mt-0.5">Week</span>
    </button>
    <button onclick="showPage('progress')" class="nav-btn flex flex-col items-center py-3 px-4 text-slate-500" data-page="progress">
      <span class="text-xl">ğŸ“Š</span><span class="text-[10px] mt-0.5">Progress</span>
    </button>
  </div>
</nav>

<!-- Timer Popup Overlay -->
<div id="timer-popup" class="fixed inset-0 z-50 flex items-end justify-center sm:items-end sm:justify-end pointer-events-none hide">
  <!-- Expanded Card -->
  <div id="timer-popup-card" class="pointer-events-auto m-4 mb-6 sm:mr-6 w-full max-w-sm bg-navy-900 border border-slate-700 rounded-2xl shadow-2xl shadow-black/50 overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-3 bg-navy-800 border-b border-slate-700">
      <span class="text-sm font-bold text-fire-400">â± Workout Timer</span>
      <div class="flex gap-2">
        <button onclick="minimizeTimerPopup()" class="text-slate-400 hover:text-white text-lg px-1" title="Minimize">â”€</button>
        <button onclick="closeTimerPopup()" class="text-slate-400 hover:text-red-400 text-lg px-1" title="Close">âœ•</button>
      </div>
    </div>
    <!-- Timer Display -->
    <div class="p-4">
      <div class="flex items-center justify-between mb-3">
        <div>
          <div class="text-3xl font-mono font-bold" id="timer-display">00:00</div>
          <div class="text-xs text-slate-400" id="timer-label">Workout Timer</div>
        </div>
        <div class="flex gap-2">
          <button onclick="toggleTimer()" id="timer-btn" class="bg-fire-500 hover:bg-fire-600 text-white font-bold px-6 py-3 rounded-xl text-lg active:scale-95 transition">â–¶ï¸</button>
          <button onclick="resetTimer()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-3 rounded-xl active:scale-95 transition">â†º</button>
        </div>
      </div>
      <!-- Rest Timer -->
      <div id="rest-timer-section" class="hide pt-3 border-t border-slate-700">
        <div class="flex items-center justify-between">
          <span class="text-sm text-fire-400">Rest Timer</span>
          <div class="flex gap-2">
            <button onclick="startRest(30)" class="bg-slate-700 px-3 py-1 rounded text-sm">30s</button>
            <button onclick="startRest(60)" class="bg-slate-700 px-3 py-1 rounded text-sm">60s</button>
            <button onclick="startRest(90)" class="bg-slate-700 px-3 py-1 rounded text-sm">90s</button>
          </div>
        </div>
        <div class="text-center text-2xl font-mono font-bold mt-2 text-fire-400" id="rest-display">--</div>
      </div>
    </div>
  </div>
  <!-- Minimized Pill -->
  <div id="timer-popup-pill" onclick="expandTimerPopup()" class="pointer-events-auto hide m-4 mb-6 sm:mr-6 bg-navy-800 border border-slate-700 rounded-full px-5 py-3 shadow-2xl shadow-black/50 cursor-pointer active:scale-95 transition flex items-center gap-3">
    <span class="text-fire-400 text-lg">â±</span>
    <span class="font-mono font-bold text-lg" id="timer-pill-display">00:00</span>
  </div>
</div>

<!-- Scripts: load order matters -->
<script src="js/utils.js"></script>
<script src="js/data.js"></script>
<script src="js/timer.js"></script>
<script src="js/today.js"></script>
<script src="js/exercises.js"></script>
<script src="js/calendar.js"></script>
<script src="js/app.js"></script>
</body>
</html>
